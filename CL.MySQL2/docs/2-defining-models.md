# 2. Defining Models

CL.MySQL2 uses a set of C# attributes to map your Plain Old C# Objects (POCOs) to database tables and columns. This allows you to define your entire database schema directly in your code.

## `[Table]` Attribute

Apply this to a class to mark it as a database table.

```csharp
[Table(Name = "users")]
public class User
{
    // ... properties
}
```

- `Name`: The name of the table in the database. If omitted, the class name is used.

## `[Column]` Attribute

Apply this to a property to map it to a table column.

```csharp
[Column(Primary = true, AutoIncrement = true)]
public int Id { get; set; }

[Column(DataType = DataType.VarChar, Size = 100, NotNull = true)]
public string Username { get; set; }

[Column(Name = "created_at", DataType = DataType.DateTime, DefaultValue = "CURRENT_TIMESTAMP")]
public DateTime CreatedAt { get; set; }
```

### Key `[Column]` Properties

- `Primary`: Marks the column as the primary key.
- `AutoIncrement`: Specifies that the column value should be automatically generated by the database.
- `DataType`: The underlying MySQL data type (e.g., `DataType.Int`, `DataType.VarChar`, `DataType.Text`, `DataType.DateTime`).
- `Size`: The length for `VarChar` or `Char` types.
- `NotNull`: If `true`, the column cannot be `NULL`.
- `DefaultValue`: Sets a default value for the column in the database schema.

## Relationships

### `[ForeignKey]` (Many-to-One)

To create a many-to-one relationship (e.g., many `Posts` belong to one `Blog`), you define a foreign key property.

```csharp
[Table(Name = "posts")]
public class Post
{
    [Column(Primary = true)]
    public int Id { get; set; }

    // Foreign key property
    [Column(DataType = DataType.Int)]
    [ForeignKey(ReferenceTable = "blogs", ReferenceColumn = "Id")]
    public int BlogId { get; set; }
}
```

### `[ManyToMany]`

To define a many-to-many relationship, you must first create a class representing the junction table. Then, add collection properties to both sides of the relationship and decorate them with the `[ManyToMany]` attribute, pointing to the junction table type.

```csharp
// 1. Define the junction entity
[Table(Name = "post_tags")]
public class PostTag
{
    [Column(DataType = DataType.Int), ForeignKey("posts", "Id")]
    public int PostId { get; set; }

    [Column(DataType = DataType.Int), ForeignKey("tags", "Id")]
    public int TagId { get; set; }
}

// 2. Add navigation property to the Post class
[Table(Name = "posts")]
public class Post 
{
    [Column(Primary = true)]
    public int Id { get; set; }
    
    // ... other properties

    [ManyToMany(typeof(PostTag))]
    public ICollection<Tag> Tags { get; set; } = new List<Tag>();
}

// 3. Add navigation property to the Tag class
[Table(Name = "tags")]
public class Tag
{
    [Column(Primary = true)]
    public int Id { get; set; }

    // ... other properties

    [ManyToMany(typeof(PostTag))]
    public ICollection<Post> Posts { get; set; } = new List<Post>();
}
```
